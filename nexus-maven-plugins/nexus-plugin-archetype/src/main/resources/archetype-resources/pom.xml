<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

  <modelVersion>4.0.0</modelVersion>

  <groupId>${groupId}</groupId>
  <artifactId>${artifactId}</artifactId>
  <version>${version}</version>

  <packaging>nexus-plugin</packaging>

  <name>Nexus Plugin Archetype</name>

  <properties>
    <!-- Set the Nexus version here, against which you build the plugin -->
    <nexus-version>${nexusVersion}</nexus-version>
  </properties>

  <dependencyManagement>
    <dependencies>
      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-webapp-dependencies</artifactId>
        <version>${nexus-version}</version>
        <type>pom</type>
        <scope>import</scope>
      </dependency>
    </dependencies>
  </dependencyManagement>

  <dependencies>

    <!--
      Note: there are two sets of dependencies here, the basic (minimal dependencies needed to build Nexus plugins), and the
      ITset, that is needed if you want to write IT tests using real Nexus environment to test your plugins. If you are using
      other technique (like having separate module for IT tests), you can freely remove or just move outside of this module
      these dependencies. The ITset of requirements in this POM are put in between "#ITSet BEGINS" and "#ITSet ENDS" pair of
      comments.
    -->

    <!-- Main plugin API, pulling in what is needed -->
    <dependency>
      <groupId>org.sonatype.nexus</groupId>
      <artifactId>nexus-plugin-api</artifactId>
    </dependency>

    <!-- This dependency is only needed if you want to include REST Resources -->
    <dependency>
      <groupId>org.sonatype.nexus</groupId>
      <artifactId>nexus-rest-api</artifactId>
    </dependency>

    <!-- Basic testing -->
    <dependency>
      <groupId>org.mockito</groupId>
      <artifactId>mockito-core</artifactId>
      <version>1.7</version>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>org.sonatype.nexus</groupId>
      <artifactId>nexus-plugin-test-api</artifactId>
      <version>${nexus-version}</version>
      <scope>test</scope>
    </dependency>

    <!-- #ITSet BEGINS -->
    <!-- Nexus IT setup (dependencies below are needed if you have extensive ITs and you want to use Nexus Environment) -->
    <!-- There are plugins connected to this dependency, see below! -->
    <dependency>
      <groupId>org.sonatype.nexus</groupId>
      <artifactId>nexus-test-harness-launcher</artifactId>
      <version>${nexus-version}</version>
      <scope>test</scope>
    </dependency>
    <!-- #ITSet ENDS -->

  </dependencies>


  <build>
    <plugins>

      <!-- Needed for custom packaging -->
      <plugin>
        <groupId>org.sonatype.plugins</groupId>
        <artifactId>app-lifecycle-maven-plugin</artifactId>
        <version>1.0</version>
        <extensions>true</extensions>
        <dependencies>
          <dependency>
            <groupId>org.sonatype.plugins</groupId>
            <artifactId>app-lifecycle-nexus</artifactId>
            <version>1.0</version>
          </dependency>
        </dependencies>
      </plugin>

      <!-- Have to set source level to Java5, we use annotations -->
      <plugin>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>2.0.2</version>
        <configuration>
          <source>1.5</source>
          <target>1.5</target>
        </configuration>
      </plugin>

      <!-- #ITSet BEGINS -->
      <!-- Nexus IT setup (dependencies below are needed if you have extensive ITs and you want to use Nexus Environment) -->
      <!-- There are dependencies connected to this set of plugin, see above! -->
      <plugin>
        <groupId>org.sonatype.maven.plugin</groupId>
        <artifactId>emma-maven-plugin</artifactId>
        <version>1.1</version>
        <executions>
          <execution>
            <phase>process-classes</phase>
            <goals>
              <goal>instrument</goal>
            </goals>
          </execution>
        </executions>
      </plugin>

      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-surefire-plugin</artifactId>
        <version>2.7-SNAPSHOT</version>
        <configuration>
          <classesDirectory>${project.build.directory}/generated-classes/emma/classes</classesDirectory>
        </configuration>
      </plugin>

      <plugin>
        <groupId>org.sonatype.plugins</groupId>
        <artifactId>nexus-test-environment-maven-plugin</artifactId>
        <version>1.5</version>
        <executions>
          <execution>
            <goals>
              <goal>setup-nexus-plugin-environment</goal>
              <goal>package</goal>
            </goals>
          </execution>
        </executions>
        <configuration>
          <nexusBundleArtifact>
            <groupId>org.sonatype.nexus</groupId>
            <artifactId>nexus-oss-webapp</artifactId>
            <version>${nexus-version}</version>
            <classifier>bundle</classifier>
            <type>zip</type>
          </nexusBundleArtifact>
          <nexusVersion>${nexus-version}</nexusVersion>
        </configuration>
      </plugin>

      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-failsafe-plugin</artifactId>
        <version>2.7-SNAPSHOT</version>
        <executions>
          <execution>
            <goals>
              <goal>integration-test</goal>
              <goal>verify</goal>
            </goals>
          </execution>
        </executions>
      </plugin>

      <plugin>
        <groupId>org.sonatype.maven.plugin</groupId>
        <artifactId>emma4it-maven-plugin</artifactId>
        <version>1.3</version>
        <executions>
          <execution>
            <id>merge</id>
            <phase>verify</phase>
            <goals>
              <goal>merge</goal>
            </goals>
            <configuration>
              <searchPath>${basedir}</searchPath>
            </configuration>
          </execution>
          <execution>
            <id>report</id>
            <phase>verify</phase>
            <goals>
              <goal>report</goal>
            </goals>
            <configuration>
              <sourceSets>
                <sourceSet>
                  <directory>${basedir}</directory>
                  <includes>
                    <include>**/src/main/java/</include>
                  </includes>
                </sourceSet>
              </sourceSets>
            </configuration>
          </execution>
          <execution>
            <phase>pre-integration-test</phase>
            <id>instrument</id>
            <goals>
              <goal>instrument</goal>
            </goals>
            <configuration>
              <jarSets>
                <jarSet>
                  <directory>${project.build.directory}/nexus</directory>
                  <includes>
                    <include>**/nexus-kungfu-virusscanner-plugin-${project.version}.jar</include>
                  </includes>
                </jarSet>
              </jarSets>
            </configuration>
          </execution>
        </executions>
      </plugin>
      <!-- #ITSet ENDS -->

    </plugins>
  </build>

</project>
