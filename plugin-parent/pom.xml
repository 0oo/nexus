<!--

    Sonatype Nexus (TM) Open Source Version
    Copyright (c) 2007-2012 Sonatype, Inc.
    All rights reserved. Includes the third-party code listed at http://links.sonatype.com/products/nexus/oss/attributions.

    This program and the accompanying materials are made available under the terms of the Eclipse Public License Version 1.0,
    which accompanies this distribution and is available at http://www.eclipse.org/legal/epl-v10.html.

    Sonatype Nexus (TM) Professional Version is available from Sonatype, Inc. "Sonatype" and "Sonatype Nexus" are trademarks
    of Sonatype, Inc. Apache Maven is a trademark of the Apache Software Foundation. M2eclipse is a trademark of the
    Eclipse Foundation. All other trademarks are the property of their respective owners.

-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>org.sonatype.forge</groupId>
    <artifactId>forge-parent</artifactId>
    <version>30</version>
    <relativePath/>
  </parent>

  <groupId>org.sonatype.nexus</groupId>
  <artifactId>nexus-plugin-parent</artifactId>
  <packaging>pom</packaging>

  <version>2.4-SNAPSHOT</version>

  <properties>
    <nexus.version>2.4-SNAPSHOT</nexus.version>
    <enunciate.version>1.26.1</enunciate.version>

    <!-- See 'idea' profile -->
    <nexus-plugin.type>nexus-plugin</nexus-plugin.type>
  </properties>

  <dependencyManagement>
    <dependencies>
      <!--
      Basic dependency for *all* Nexus plugins.
      -->
      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-plugin-api</artifactId>
        <version>${nexus.version}</version>
      </dependency>

      <!--
      Import all DM entries for all dependencies known by nexus-plugin-api.
      -->
      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-plugin-api-dependencies</artifactId>
        <type>pom</type>
        <scope>import</scope>
        <version>${nexus.version}</version>
      </dependency>

      <dependency>
        <groupId>org.sonatype.nexus.client</groupId>
        <artifactId>nexus-client-core</artifactId>
        <version>${nexus.version}</version>
      </dependency>

      <!--
      Required for Nexus plugins which provide legacy restlet-1.x REST apis.
      -->
      <dependency>
        <groupId>org.sonatype.nexus.plugins</groupId>
        <artifactId>nexus-restlet1x-plugin</artifactId>
        <type>${nexus-plugin.type}</type>
        <version>${nexus.version}</version>
      </dependency>

      <!--
      HACK: Exposed here for a lack of a better way to manage.  Need to kill all these -tests.jar dependencies.
      -->
      <dependency>
        <groupId>org.sonatype.nexus.plugins</groupId>
        <artifactId>nexus-restlet1x-plugin</artifactId>
        <classifier>tests</classifier>
        <version>${nexus.version}</version>
      </dependency>

      <!--
      HACK: Exposed here for a lack of a better way to manage.
      -->
      <dependency>
        <groupId>org.sonatype.nexus.plugins</groupId>
        <artifactId>nexus-restlet1x-model</artifactId>
        <version>${nexus.version}</version>
      </dependency>

      <!--
      FIXME: Remove need for this dep once we have most bits on JAX-RS compatible resources.
      FIXME: Short-term, may want to just include this in deps provided by nexus-restlet1x-plugin?
      -->
      <dependency>
        <groupId>org.codehaus.enunciate</groupId>
        <artifactId>enunciate-core</artifactId>
        <version>${enunciate.version}</version>
        <exclusions>
          <exclusion>
            <groupId>commons-logging</groupId>
            <artifactId>commons-logging</artifactId>
          </exclusion>
          <exclusion>
            <groupId>commons-beanutils</groupId>
            <artifactId>commons-beanutils</artifactId>
          </exclusion>
          <exclusion>
            <groupId>commons-digester</groupId>
            <artifactId>commons-digester</artifactId>
          </exclusion>
          <exclusion>
            <groupId>net.sf.apt-jelly</groupId>
            <artifactId>apt-jelly-freemarker</artifactId>
          </exclusion>
          <exclusion>
            <groupId>javax.servlet</groupId>
            <artifactId>servlet-api</artifactId>
          </exclusion>
        </exclusions>
      </dependency>

      <!--
      Required for plugins which provide JAX-RS REST apis.
      -->
      <!--<dependency>-->
        <!--<groupId>org.sonatype.nexus.plugins</groupId>-->
        <!--<artifactId>nexus-siesta-plugin</artifactId>-->
        <!--<type>${nexus-plugin.type}</type>-->
        <!--<version>${nexus.version}</version>-->
      <!--</dependency>-->

      <!--
      Required for Nexus plugins which provide indexer integration.
      -->
      <dependency>
        <groupId>org.sonatype.nexus.plugins</groupId>
        <artifactId>nexus-indexer-lucene-plugin</artifactId>
        <type>${nexus-plugin.type}</type>
        <version>${nexus.version}</version>
      </dependency>

      <!--
      Basic dependency for *all* Nexus plugins which provide tests.
      -->
      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-plugin-test-api</artifactId>
        <version>${nexus.version}</version>
      </dependency>

      <!--
      Import all DM entries for all dependencies known by nexus-plugin-test-api.
      -->
      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-plugin-test-api-dependencies</artifactId>
        <type>pom</type>
        <scope>import</scope>
        <version>${nexus.version}</version>
      </dependency>

      <!--
      Basic dependency for Nexus plugins which provide _bundle-launcher-style_ integration-tests.
      FIXME: Consider adding this into nexus-plugin-test-api
      -->
      <dependency>
        <groupId>org.sonatype.nexus</groupId>
        <artifactId>nexus-testsuite-support</artifactId>
        <version>${nexus.version}</version>
      </dependency>

    </dependencies>
  </dependencyManagement>

  <build>
    <pluginManagement>
      <plugins>
        <!--
        Nexus plugins require Java 6 minimum.
        -->
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-compiler-plugin</artifactId>
          <configuration>
            <source>1.6</source>
            <target>1.6</target>
          </configuration>
        </plugin>

        <!--
        Support for nexus-plugin packaging.
        -->
        <plugin>
          <groupId>org.sonatype.plugins</groupId>
          <artifactId>app-lifecycle-maven-plugin</artifactId>
          <version>1.7</version>
          <extensions>true</extensions>
          <dependencies>
            <dependency>
              <groupId>org.sonatype.plugins</groupId>
              <artifactId>app-lifecycle-nexus</artifactId>
              <version>1.7</version>
            </dependency>
          </dependencies>
        </plugin>

        <!--
        Support for nexus-plugin packaging (replaces app-lifecycle-maven-plugin).
        -->
        <!--<plugin>-->
        <!--<groupId>org.sonatype.nexus</groupId>-->
        <!--<artifactId>nexus-plugin-bundle-maven-plugin</artifactId>-->
        <!--<version>1.0-SNAPSHOT</version>-->
        <!--<extensions>true</extensions>-->
        <!--</plugin>-->

        <!--
        Required for nexus-plugin packaging (via nexus-plugin-bundle-maven-plugin).
        -->
        <!--<plugin>-->
        <!--<groupId>org.codehaus.mojo</groupId>-->
        <!--<artifactId>aspectj-maven-plugin</artifactId>-->
        <!--<configuration>-->
        <!--<source>1.6</source>-->
        <!--<target>1.6</target>-->
        <!--</configuration>-->
        <!--</plugin>-->

        <!--
        For legacy-plugins which still need Plexus descriptors.
        -->
        <plugin>
          <groupId>org.codehaus.plexus</groupId>
          <artifactId>plexus-component-metadata</artifactId>
          <version>1.5.5</version>
          <dependencies>
            <dependency>
              <groupId>com.thoughtworks.qdox</groupId>
              <artifactId>qdox</artifactId>
              <version>1.12</version>
            </dependency>
          </dependencies>
          <executions>
            <execution>
              <goals>
                <goal>generate-metadata</goal>
                <goal>generate-test-metadata</goal>
              </goals>
            </execution>
          </executions>
        </plugin>

        <!--
        Support for Nexus plugins which provide a UI.
        -->
        <plugin>
          <groupId>net.alchim31.maven</groupId>
          <artifactId>yuicompressor-maven-plugin</artifactId>
          <version>1.3.2</version>
          <configuration>
            <sourceDirectory>${project.basedir}/src/main</sourceDirectory>
            <outputDirectory>${project.build.directory}/generated-sources/yuicompressor</outputDirectory>
            <includes>
              <include>js/**/*.js</include>
              <include>css/**/*.css</include>
            </includes>
            <nosuffix>true</nosuffix>
          </configuration>
          <executions>
            <execution>
              <id>aggregate</id>
              <goals>
                <goal>compress</goal>
              </goals>
              <configuration>
                <jswarn>false</jswarn>
                <failOnWarning>false</failOnWarning>
                <aggregations>
                  <aggregation>
                    <inputDir>${project.build.directory}/generated-sources/yuicompressor</inputDir>
                    <output>${project.build.directory}/classes/static/js/${project.artifactId}-all.js</output>
                    <includes>
                      <include>**/*.js</include>
                    </includes>
                  </aggregation>
                  <aggregation>
                    <inputDir>${project.build.directory}/generated-sources/yuicompressor</inputDir>
                    <output>${project.build.directory}/classes/static/css/${project.artifactId}-all.css</output>
                    <includes>
                      <include>**/*.css</include>
                    </includes>
                  </aggregation>
                </aggregations>
              </configuration>
            </execution>
          </executions>
        </plugin>

        <!--
        Support for bridging maven configuration to test-suite executions.
        -->
        <plugin>
          <groupId>org.sonatype.plugins</groupId>
          <artifactId>sisu-maven-bridge-maven-plugin</artifactId>
          <version>3.0</version>
        </plugin>
      </plugins>
    </pluginManagement>
  </build>

  <profiles>
    <!--
    Enable integration-tests.
    -->
    <profile>
      <id>it</id>

      <activation>
        <property>
          <name>it</name>
          <value>true</value>
        </property>
      </activation>

      <build>
        <plugins>
          <plugin>
            <groupId>org.sonatype.plugins</groupId>
            <artifactId>sisu-maven-bridge-maven-plugin</artifactId>
            <executions>
              <execution>
                <goals>
                  <goal>export</goal>
                </goals>
              </execution>
            </executions>
          </plugin>

          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-failsafe-plugin</artifactId>
            <executions>
              <execution>
                <goals>
                  <goal>integration-test</goal>
                  <goal>verify</goal>
                </goals>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>

    <!--
    Generates Nexus plugin REST documentation, which is included in plugin bundles.
    -->
    <profile>
      <id>enunciate</id>

      <activation>
        <file>
          <exists>enunciate.xml</exists>
        </file>
      </activation>

      <build>
        <plugins>
          <plugin>
            <groupId>org.codehaus.enunciate</groupId>
            <artifactId>maven-enunciate-slim-plugin</artifactId>
            <version>${enunciate.version}</version>
            <dependencies>
              <dependency>
                <groupId>org.codehaus.enunciate</groupId>
                <artifactId>enunciate-docs</artifactId>
                <version>${enunciate.version}</version>
              </dependency>
              <!--
              enunciate-xml module is needed to properly handle 'defaultRestSubcontext' configuration, which is used to generate the mount point location in documentation.
              when this dependency is included the module appears to be automatically enabled.
              -->
              <dependency>
                <groupId>org.codehaus.enunciate</groupId>
                <artifactId>enunciate-xml</artifactId>
                <version>${enunciate.version}</version>
              </dependency>
            </dependencies>
            <executions>
              <execution>
                <phase>process-classes</phase>
                <goals>
                  <goal>docs</goal>
                </goals>
                <configuration>
                  <configFile>enunciate.xml</configFile>
                  <docsDir>${project.build.outputDirectory}/docs</docsDir>
                </configuration>
              </execution>
            </executions>
          </plugin>
        </plugins>
      </build>
    </profile>

    <!--
    Support for loading Nexus plugin projects in Intellij IDEA.
    -->
    <profile>
      <id>idea</id>
      <properties>
        <nexus-plugin.type>jar</nexus-plugin.type>
      </properties>
    </profile>
  </profiles>

</project>
